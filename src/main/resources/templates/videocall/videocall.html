<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <th:block th:replace="/fragments/script_style::main_style"></th:block>
    <title>VideoCall</title>
    <style>
        #root {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>


<body>
<div id="root"></div>

<th:block th:if="${#authorization.expression('hasRole(''ROLE_TEACHER'')')}">

    <main role="main" class="main-content">
        <div class="container-fluid">
            <div class="row justify-content-center text-center"> <!-- Центрируем строку -->
                <div class="col-12 col-md-6"> <!-- Используем половину ширины экрана для формы -->
                    <form th:action="@{/teachers/interviews/{id}(id = ${user.getId()})}" th:method="patch" th:object="${interview}">
                        <div class="card shadow mb-4">
                            <div class="card-body">
                                <p class="h5 mb-4 mt-3 text-center"><strong>Assessment</strong></p>
                                <div class="form-group row align-items-center">
                                    <label for="example-number" class="text-dark col-2" style="font-size: 16px;">Grade: </label>
                                    <input class="form-control col-9" id="example-number" type="number" th:field="*{grade}" name="number">
                                </div>

                                <button type="submit" class="btn mb-2 btn-outline-primary btn-lg btn-block">Estimate</button>
                            </div> <!-- /.card-body -->
                        </div> <!-- /.card -->
                    </form> <!-- /.col -->
                </div>
            </div>
        </div>
    </main>


</th:block>
</body>
<script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
<script th:inline="javascript">

    window.onload = function () {
        function getUrlParams(url) {
            let urlStr = url.split('?')[1];
            const urlSearchParams = new URLSearchParams(urlStr);
            const result = Object.fromEntries(urlSearchParams.entries());
            return result;
        }

        const roomID = getUrlParams(window.location.href)['roomID'] || ([[${user.getInterview().getMeetId()}]] + "");
        const userID = [[${teacher.getId()}]] + "";
        const userName = getUrlParams(window.location.href)['username'] || [[${teacher.getEmail()}]];
        const appID = 632287415;
        const serverSecret = "efa17fd0c46ef7656bd0211d6d8f590c";
        const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, userID, userName);


        const zp = ZegoUIKitPrebuilt.create(kitToken);
        zp.joinRoom({
            container: document.querySelector("#root"),
            sharedLinks: [{
                name: 'Personal link',
                url: 'http://localhost:8000/videocall/' + [[${user.getId()}]] + '?roomID=' + [[${user.getInterview().getMeetId()}]],
            }],
            scenario: {
                mode: ZegoUIKitPrebuilt.VideoConference,
            },

            turnOnMicrophoneWhenJoining: false,
            turnOnCameraWhenJoining: false,
            showMyCameraToggleButton: true,
            showMyMicrophoneToggleButton: true,
            showAudioVideoSettingsButton: true,
            showScreenSharingButton: true,
            showTextChat: true,
            showUserList: true,
            maxUsers: 2,
            layout: "Auto",
            showLayoutButton: false,

        });
    }
</script>

<script th:if="${#authorization.expression('hasRole(''ROLE_TEACHER'')')}" th:inline="javascript">
    let input = document.getElementById("example-number");

    input.addEventListener("input", function() {
        let min = 0;
        console.log(min)
        let max = 100;
        console.log(max)
        let value = parseInt(input.value);
        console.log(value)

        if (isNaN(value) || value < min) {
            input.value = min;
        } else if (value > max) {
            input.value = max;
        }
    });
</script>

<th:block th:replace="/fragments/script_style::main_script"></th:block>
</html>